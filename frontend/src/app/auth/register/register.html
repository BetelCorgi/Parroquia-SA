<section class="register-shell">
  <!-- Panel ilustrativo -->
  <aside class="register-left">
    <div class="left-inner">
      <img [src]="logoUrl" alt="Logo de la Parroquia" class="left-logo">
      <h2 class="left-title">Parroquia San Agustín</h2>
      <p class="left-text">
        Únete a la comunidad y recibe noticias, actividades y oraciones personalizadas
        para tus comunidades favoritas.
      </p>
      <div class="left-cards">
        <div class="mini-card">
          <i class="fa-solid fa-people-group"></i>
          <span>Selecciona tu comunidad</span>
        </div>
        <div class="mini-card">
          <i class="fa-solid fa-envelope-circle-check"></i>
          <span>Confirma tu correo para activar tu cuenta</span>
        </div>
      </div>
    </div>
  </aside>

  <!-- Panel del formulario -->
  <main class="register-right">
    <button type="button" class="back-btn" (click)="goHome()" aria-label="Volver al inicio">
      <i class="fa-solid fa-arrow-left"></i>
      <span>Volver al inicio</span>
    </button>

    <div class="form-card">
      <header class="card-head">
        <h1>Crea tu cuenta de fiel</h1>
        <p>Ingresa tus datos para registrarte y recibir un correo de verificación.</p>
      </header>

      <form class="register-form" [formGroup]="form" (ngSubmit)="submit()" novalidate>
        <div class="grid-2">
          <label class="field">
            <span>DNI *</span>
            <input type="text" formControlName="dni" placeholder="00000000">
            <small class="error" *ngIf="form.controls.dni.touched && form.controls.dni.invalid">
              Ingresa un DNI válido de 8 dígitos.
            </small>
          </label>

          <label class="field">
            <span>Correo electrónico *</span>
            <input type="email" formControlName="email" placeholder="tu@correo.com">
            <small class="error" *ngIf="form.controls.email.touched && form.controls.email.invalid">
              Debes ingresar un correo válido.
            </small>
          </label>
        </div>

        <div class="grid-2">
          <label class="field">
            <span>Nombre *</span>
            <input type="text" formControlName="nombre" placeholder="Juan">
            <small class="error" *ngIf="form.controls.nombre.touched && form.controls.nombre.invalid">
              Este campo es obligatorio.
            </small>
          </label>

          <label class="field">
            <span>Apellido *</span>
            <input type="text" formControlName="apellido" placeholder="Pérez">
            <small class="error" *ngIf="form.controls.apellido.touched && form.controls.apellido.invalid">
              Este campo es obligatorio.
            </small>
          </label>
        </div>

        <div class="grid-2">
          <label class="field">
            <span>Teléfono</span>
            <input type="tel" formControlName="telefono" placeholder="999 999 999">
          </label>

          <label class="field">
            <span>Fecha de nacimiento</span>
            <input type="date" formControlName="fechaNacimiento">
          </label>
        </div>

        <div class="grid-2">
          <label class="field">
            <span>Comunidad</span>
            <select formControlName="comunidadId" [disabled]="isLoadingCommunities">
              <option [ngValue]="null">Selecciona una comunidad (opcional)</option>
              <option *ngIf="isLoadingCommunities" disabled>Cargando comunidades...</option>
              <option *ngFor="let comunidad of communities" [ngValue]="comunidad.idComunidad">
                {{ comunidad.nombre }}
              </option>
            </select>
          </label>

          <label class="field">
            <span>Rol en la comunidad</span>
            <input type="text" formControlName="rolComunidad" placeholder="Ej. Ministro de música">
          </label>
        </div>

        <div class="grid-2">
          <label class="field">
            <span>Contraseña *</span>
            <div class="password-wrap">
              <input [type]="showPassword ? 'text' : 'password'" formControlName="password" placeholder="••••••••">
              <button type="button" class="toggle-pass" (click)="showPassword = !showPassword" aria-label="Mostrar u ocultar contraseña">
                <i class="fa-solid" [class.fa-eye]="!showPassword" [class.fa-eye-slash]="showPassword"></i>
              </button>
            </div>
            <small class="extra">Mínimo 8 caracteres.</small>
          </label>

          <label class="field">
            <span>Confirmar contraseña *</span>
            <div class="password-wrap">
              <input [type]="showConfirmPassword ? 'text' : 'password'" formControlName="confirmPassword" placeholder="••••••••">
              <button type="button" class="toggle-pass" (click)="showConfirmPassword = !showConfirmPassword" aria-label="Mostrar u ocultar confirmación">
                <i class="fa-solid" [class.fa-eye]="!showConfirmPassword" [class.fa-eye-slash]="showConfirmPassword"></i>
              </button>
            </div>
          </label>
        </div>

        <p class="error" *ngIf="serverError">{{ serverError }}</p>
        <p class="success" *ngIf="successMessage">{{ successMessage }}</p>

        <button type="submit" class="submit-btn" [disabled]="isSubmitting">
          <span *ngIf="!isSubmitting">Crear cuenta</span>
          <span *ngIf="isSubmitting" class="spinner">
            <i class="fa-solid fa-circle-notch fa-spin"></i> Registrando...
          </span>
        </button>
      </form>

      <footer class="card-foot">
        <p>¿Ya tienes una cuenta? <a routerLink="/login">Inicia sesión</a></p>
      </footer>
    </div>
  </main>
</section>
